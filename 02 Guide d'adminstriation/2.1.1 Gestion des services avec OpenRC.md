 OpenRC est le systÃ¨me dâ€™initialisation (init system) utilisÃ© par Alpine Linux.  
Il est **simple, lisible, modulaire**, et respecte la philosophie Unix :  
> [!important] 
> **un service = un processus**.

Ce chapitre couvre la partie adminsitration des services, comment les activation, dÃ©sactiver, diagnostiquer des erreurs, et comprendre comment Alpine organise son dÃ©marrage.
# PrÃ©sentation dâ€™OpenRC

## RÃ´le dâ€™OpenRC
- dÃ©marrer les services au boot
- arrÃªter proprement les services Ã  lâ€™extinction    
- fournir des outils simples pour contrÃ´ler les services    
- organiser les runlevels (niveaux dâ€™exÃ©cution)    

OpenRC ne tourne **pas en permanence** en arriÃ¨re-plan (contrairement Ã  systemd).  
Il sâ€™active uniquement lorsquâ€™on exÃ©cute une action : start, stop, statusâ€¦
# 2. OÃ¹ sont les services ?

## Les services eux-mÃªmes :

```
/etc/init.d/
```

Chaque service correspond Ã  **un fichier** :
```
/etc/init.d/sshd
/etc/init.d/networking
/etc/init.d/nginx
...
```

> [!INFO]  
> Un â€œserviceâ€ dans OpenRC nâ€™est rien dâ€™autre quâ€™un **script shell**.

---

# 3. OÃ¹ se trouve les services activÃ©s au dÃ©marrage ?

## ðŸ“ dans les runlevels :

```
/etc/runlevels/
```

> [!example] Runlevels importants :
> | Runlevel     | RÃ´le                                       |
> | ------------ | ------------------------------------------ |
> | **boot**     | Services nÃ©cessaires au dÃ©marrage          |
> | **default**  | Services lancÃ©s automatiquement aprÃ¨s boot |
> | **shutdown** | Services arrÃªtÃ©s lors de lâ€™extinction      |
> 

Pour ce  TP, le runlevel le plus important sera :
```
/etc/runlevels/default
```

Câ€™est ici quâ€™OpenRC regarde **quels services dÃ©marrer automatiquement** Ã  chaque dÃ©marrage.

# 4. Commandes essentielles avec rc-service

## DÃ©marrer un service
```sh
rc-service <service> start
```
## ArrÃªter un service
```sh
rc-service <service> stop
```
## RedÃ©marrer un service
```sh
rc-service <service> restart
```
## Afficher lâ€™Ã©tat dâ€™un service
```sh
rc-service <service> status
```

> [!example] Exemple
> ```sh
> rc-service sshd status
> ```
> 
# 5. Commandes essentielles avec rc-update

## Activer un service au dÃ©marrage

```sh
rc-update add <service>
```

> [!example]  Exemple :
> ```sh
> rc-update add sshd
> ```
> 

Cela crÃ©e un lien symbolique dans :
```
/etc/runlevels/default/
```
## DÃ©sactiver un service au dÃ©marrage

```sh
rc-update del <service>
```
## Afficher les services actifs au dÃ©marrage

```sh
rc-update show
```
## Afficher **tous** les services disponibles

```sh
rc-update -v show
```
# 6. Fichiers de configuration des services

Chaque service a souvent :
- un script dans `/etc/init.d/`    
- un fichier de configuration dans `/etc/conf.d/`

> [!example] Exemples
> ```
> /etc/init.d/sshd
> /etc/conf.d/sshd
> ```

> [!NOTE]  
> La configuration ne se modifie **jamais** dans `/etc/init.d/`.  
> Elle se modifie dans `/etc/conf.d/<service>`.

## Tester manuellement le script

Tous les scripts OpenRC acceptent :
```sh
/etc/init.d/<service> start
/etc/init.d/<service> status
```  

> [!summary]  RÃ©fÃ©rences> 
> - Alpine Linux â€“ OpenRC : [https://wiki.alpinelinux.org/wiki/OpenRC](https://wiki.alpinelinux.org/wiki/OpenRC)
> - OpenRC Handbook (Gentoo) : [https://wiki.gentoo.org/wiki/OpenRC](https://wiki.gentoo.org/wiki/OpenRC)
> - Alpine services : [https://wiki.alpinelinux.org/wiki/Services](https://wiki.alpinelinux.org/wiki/Services)


> [!danger]  Erreurs frÃ©quentes
> - Modifier un script dans `/etc/init.d`
> - Activer un service sans lâ€™avoir installÃ© 
> - Croire que `rc-update` dÃ©marre un service (ce nâ€™est pas le cas) 
> - Oublier dâ€™activer un service avant un redÃ©marrage 

# 9. Exercices

## ðŸ“ **Exercice 1 â€“ DÃ©couverte**

> [!warning]  A rendre
> 
> 1. Listez **tous** les services disponibles.
> 2. Listez les services activÃ©s au dÃ©marrage.
> 3. Donnez le chemin exact du script du service `networking`.
> 
> **Ã€ rendre sous forme de commandes + rÃ©ponses.**

## ðŸ“ **Exercice 2 â€“ Manipulation**

> [!warning] A rendre
> 1. DÃ©marrez le service `crond`.
> 2. VÃ©rifiez son Ã©tat.
> 3. Activez-le au dÃ©marrage.
> 4. RedÃ©marrez la machine.
> 5. VÃ©rifiez quâ€™il est bien actif aprÃ¨s redÃ©marrage.
> 
> **Ã€ rendre sous forme de commandes + rÃ©ponses.**

## ðŸ“ **Exercice 3 â€“ Analyse**

> [!Warning] A rendre
> 
> Expliquez la diffÃ©rence entre :
> 
> ```
> rc-service sshd start
> ```
> 
> et
> 
> ```
> rc-update add sshd
> ```
>     

## ðŸ“ **Exercice 4 â€“ Recherche documentaire**

> [!warning] A rendre
> Ã€ partir de la documentation officielle Alpine :
> 
> ðŸ‘‰ Donnez le rÃ´le des dossiers :
> 
> - `/etc/init.d`
> - `/etc/runlevels/default`
> - `/etc/conf.d`
> 
> (Citer URLs + extraits.)
> 

