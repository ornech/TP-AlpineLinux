# 2.7 Configuration du rÃ©seau sous Alpine

## 1. Architecture & principes

- Alpine Linux utilise par dÃ©faut le gestionnaire dâ€™interfaces rÃ©seau ifupdownâ€‘ng (via le package alpine-conf) pour gÃ©rer les interfaces rÃ©seau [^1]
- Les scripts de configuration rÃ©seau sont fournis dans le package alpine-conf et incluent : 
	- [setup-hostname](https://wiki.alpinelinux.org/wiki/Configure_Networking)
	- [setup-interfaces](https://wiki.alpinelinux.org/wiki/Configure_Networking#setup-interfaces)
	- [setup-dns](https://wiki.alpinelinux.org/wiki/Alpine_setup_scripts#setup-dns)
	- [setup-proxy](https://wiki.alpinelinux.org/wiki/Alpine_setup_scripts#setup-proxy)
	- [setup-ntp](https://wiki.alpinelinux.org/wiki/Alpine_setup_scripts#setup-ntp)
- Le systÃ¨me dâ€™init est OpenRC, et le service rÃ©seau est gÃ©rÃ© via les scripts dâ€™OpenRC (ex. `/etc/init.d/networking`).

# Configuration de base du rÃ©seau
## Solution 1: `setup-interfaces`
Ce script permet de configurer des interfaces Ethernet, Wi-Fi, bridge, bond ou VLAN, et suffit pour la majoritÃ© des configurations.
Lancez
``` bash
setup-interfaces
```
Le script va dÃ©tecter les interfaces disponibles (ex. eth0, wlan0), puis demander pour chaque interface le type de configuaration souhaitÃ© (IP statique ou DHCP)

> [!quote] Information
> Vous devez bien Ã©videment avoir anticipÃ© un plan d'adressage IP.
> 
> *"Quand tu mets une IP au hasard, câ€™est comme envoyer un message Ã  la mauvaise personne : Ã§a fait souvent des histoires. * ðŸ˜‰"

## Solution 2: Ã©diter le fichier `interfaces`
Editez le fichier `/etc/network/interfaces`
```
nano /etc/network/interfaces
```
Exemple IP static:
```
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

auto eth1
iface eth1 inet static
    address 192.168.56.20
    netmask 255.255.255.0
    # gateway 192.168.56.1 # A commenter pour ne pas utiliser cette interface comme passerelle
```

RedÃ©marrez le service `networking`
```bash
rc-service networking restart
```
VÃ©rifiez voter configuration rÃ©seau
```sh
ip a
```

VÃ©rifiez la route par dÃ©faut
```sh
ip route
```
Testez la connexion vers votre hÃ´te
```sh
ping 192.168.56.1
```
Testez la connexion vers internet
```sh
ping perdu.com
```
## DÃ©pannage rÃ©seau

> [!bug] ProcÃ©dure dÃ©pannage
> 1. VirtualBox -> 2 interfaces rÃ©seaux : `rÃ©seau NAT`(avec DHCP actif) et `RÃ©seau d'hÃ´te privÃ©`
> 2. VirtualBox -> "cables branchÃ©s"
> 3. `ip link` â†’ interface UP ? 
> 4. `ip a` â†’ IP et masque correcte ?
> 5. `ip route` â†’ VÃ©rifiez **UNE SEULE route par dÃ©faut** (`default via 10.0.2.1 dev eth0`)
> 6. `ping 192.168.56.1` â†’ LAN OK ?
> 7. `ping 8.8.8.8` â†’ Internet OK ?
> 8. `ping google.fr` â†’ DNS OK ?
> 9. `nslookup google.fr` â†’ DNS dÃ©tails
> 10. `nc -vz google.fr 443` â†’ port OK ?
> 11. `ss -ltnp`â†’ service Ã©coute ?
> 12. `iptables -L -n`â†’ firewall ?
> 13. `tcpdump -i eth0` â†’ sniff si nÃ©cessaire



[^1]: https://wiki.alpinelinux.org/wiki/Configure_Networking
