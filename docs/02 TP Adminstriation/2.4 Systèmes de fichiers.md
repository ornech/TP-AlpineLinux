# 2.4 Syst√®mes de fichiers sous Alpine

## Objectif du TP

On va essayer de conprenre ce qu‚Äôest un **syst√®me de fichiers**, pourquoi `/` est appel√© la **racine**, et en quoi le **montage** conditionne l‚Äôacc√®s aux donn√©es et √† l‚Äô√©tat du syst√®me.

## Rappels

Un syst√®me Unix/Linux pr√©sente **une seule arborescence**, accessible √† partir de `/`. Contrairement √† Windows, il n‚Äôexiste pas de notion de lecteur (c: ou d:).  

> [!NOTE]  Arborescence
> 1) Une arborescence est une organisation hi√©rarchique de fichiers et de r√©pertoires, structur√©e √† partir d‚Äôun point d'entr√© unique: la **racine**  not√©e `/`.  
> 2) Un fichier ou un r√©pertoire occupe une position unique dans cette arborescence, et peut √™tre  localis√© par son **chemin d‚Äôacc√®s** en partant de la racine. Par exemple: /dossier-A/dossier-2/fichier3.txt 

> [!NOTE] **R√©pertoire de travail** 
> √Ä l‚Äôouverture d‚Äôune session Unix, le syst√®me cr√©e un **environnement d‚Äôex√©cution** pour l‚Äôutilisateur authentifi√©. Le **shell**, lanc√© dans cette session, est un **processus** qui h√©rite de cet environnement.  Cet environnement inclut un **r√©pertoire de travail initial**, correspondant au **r√©pertoire personnel** d√©fini dans `/etc/passwd`.  
> Ce r√©pertoire est utilis√© par le shell pour r√©soudre les **chemins relatifs** lors de l‚Äôex√©cution des commandes.

## 1. Navigation dans l‚Äôarborescence Unix

> [!NOTE] Rappel
> `/` est le point d‚Äôentr√©e de l‚Äôarborescence Unix (la racine).
> Un chemin commen√ßant par `/` d√©signe **explicitement** le chemin d'un fichier depuis la racine.

Commen√ßons par quelques manipulations:
```sh
pwd
```
La commande `pwd` (print working directory) affiche le dossier dans lequel shell est en train d'√™tre ex√©cut√©. On pourrait dire que `pwd` retourne le r√©pertoire o√π l‚Äôon se trouve, mais c‚Äôest une explication un peu rapide.
En r√©alit√©, **vous** n‚Äô√™tes pas ¬´ dans un dossier ¬ª ( vous √™tes assis sur une chaise...). Par contre le shell est un processus qui s‚Äôex√©cute avec un contexte,  et ce contexte inclut un r√©pertoire de travail. C‚Äôest ce r√©pertoire de travail que la commande `pwd` affiche.
Bon, apr√®s si vous avez rien compris "*retourne le r√©pertoire on l'on se trouve*", √ßa ira quand m√™me.
```sh
cd /
pwd
```
Le nouveau  r√©pertoire courant est  maintenant la racine soit`/`.
```sh
cd /etc
pwd
```
Ici, le chemin commence par `/`, ce qui signifie que l‚Äôon part de la racine, puis que l‚Äôon descend dans le dossier `etc`. Comme le dossier `etc` est bien pr√©sent √† cet emplacement, le changement de r√©pertoire se fait sans erreur.
Essayez ceci:
```sh
cd /
cd etc
pwd
```
On arrive encore dans /etc.
Pourtant, on n‚Äôa pas tap√© `/etc`, seulement `etc`.

Pourquoi √ßa marche ?
Parce que le r√©pertoire `etc` est recherch√© *par d√©faut* dans le **r√©pertoire de travail** ($PWD), ici la racine /.
Et comme il existe bien un dossier nomm√© `etc` √† cet emplacement, la commande aboutit sans erreur.

On n‚Äôa donc pas utilis√© un chemin absolu pour atteindre un dossier, mais un chemin relatif : relatif √† quoi ? et bien au **r√©pertoire de travail**.
```sh
cd /home
pwd
```
Constat : on arrive dans `/home`.  
Raison : le chemin commence par `/` ‚Üí le r√©pertoire `home` est explicitement recherch√© **√† la racine**. Sans surprise √ßa marche, on l'a d√©j√† vu.
```sh
cd /etc
cd home
```
Constat : erreur.  
`cd home` est interpr√©t√© comme un **chemin relatif** (pas / au d√©but). Comme on l'a vu il sera recherch√© dans le r√©pertoire de travail, soit `/etc`, o√π il n‚Äôexiste pas. La commande ne peut pas aboutir sans passer par un chemin absolu.
```sh
cd /home
pwd
```
Notez que l'on aurait pu faire autrement. Retournons dans le r√©pertoire `/etc`. Maintenant vous avez du vous en rendre compte dans l‚Äôarborescence UNIX, le r√©pertoire home est situ√© √† un niveau au dessus de `etc`. Donc si l'on souhaitait tout de meme utilis√© un chemin relatif pour y acc√©der on peut utiliser les caract√®res `..`. Les 2 points indiquent au SHELL de remonter d'un niveau l'arborescence depuis le r√©pertoire de travail
```sh
cd /etc
cd ..
cd home
pwd

```
Et si on est √©t√© encore plus fain√©ant, on peut m√™me faire de cette mani√®re
```sh
cd /etc
cd ../home
pwd
```
`../home` indique √† SHELL que dans le r√©pertoire parent, il y a un dossier home, ce qui est exact, donc notre commande aboutie.

On peut m√™me faire encore plus fort. 
```sh
cd /home/alice
pwd
cd ../../etc
pwd
```
`cd ../../etc` indique que l'on souhaite se rendre dans le dossier etc, qui se trouve 2 niveaux au dessus de notre r√©pertoire de travail. 


> [!NOTE] √Ä retenir
> 
> - L‚Äôarborescence Unix est organis√©e √† partir d‚Äôun point d‚Äôentr√©e unique : `/`, appel√© la **racine**.
>     
> - Un **chemin absolu** commence par `/` : il indique le chemin complet √† suivre depuis la racine pour atteindre un emplacement dans l‚Äôarborescence.
>     
> - Un **chemin relatif** est interpr√©t√© √† partir du **r√©pertoire de travail** du shell.
>     
> - Le **r√©pertoire de travail** est le contexte dans lequel le shell s‚Äôex√©cute.
>     
> - Les caract√®res `..` permettent de remonter d‚Äôun niveau dans l‚Äôarborescence (`../..` pour 2 niveaux, `../../..` pour 3 niveaux, et ainsi de suite).
>
## 2. Notion de syst√®me de fichiers

Un disque ne stocke que des donn√©es brutes.  Pour pouvoir les exploiter sous forme de fichiers et de r√©pertoires, le syst√®me d‚Äôexploitation s‚Äôappuie sur un **syst√®me de fichiers**.

Un syst√®me de fichiers comme **ext4** d√©finit **comment** les donn√©es brutes doivent √™tre structur√©es sur le disque afin de pouvoir localiser et r√©cup√©rer des fichiers, des r√©pertoires, leurs droits, et leurs m√©tadonn√©es.

Dans la pratique, un syst√®me de fichiers ext4 s‚Äôapplique sur un **espace de stockage bien identifi√©**, comme une **partition** ou un volume logique. Cette op√©ration, appel√©e **formatage**, est dite destructive, car elle efface les informations qui permettent au syst√®me de localiser et d‚Äôinterpr√©ter les donn√©es, m√™me si celles-ci peuvent encore √™tre pr√©sentes physiquement.

```sh
df -T
```

```
Filesystem           Type       1K-blocks      Used Available Use% Mounted on
devtmpfs             devtmpfs       10240         0     10240   0% /dev
shm                  tmpfs         236900         0    236900   0% /dev/shm
/dev/sda3            ext4         6924276    161736   6389500   2% /
tmpfs                tmpfs          94760       128     94632   0% /run
/dev/sda1            ext4          277631     37102    221073  14% /boot
tmpfs                tmpfs         236900         0    236900   0% /tmp
```
Comment lire ce truc ? Prenons cette ligne:
```
/dev/sda3            ext4         6924276    161736   6389500   2% /
```
-  `/dev/sda3`: Partition
- **ext4** Syst√®me de fichiers utilis√©
-  On laisse de cot√© les colonnes 1K-blocks, Used et Available
- 
## 6. Tous les √©l√©ments visibles ne proviennent pas d‚Äôun disque

Observer :

```sh
mount
ls /proc
ls /sys
```

Constat :  
`/proc` et `/sys` sont des **syst√®mes de fichiers mont√©s**, mais ne correspondent pas √† un disque.  
Ils exposent l‚Äô√©tat interne du noyau et du mat√©riel.

üëâ Le montage ne sert pas uniquement aux disques :  
il permet au noyau de rendre accessibles des informations internes via l‚Äôarborescence.

---

## 7. Organisation normalis√©e de l‚Äôarborescence

Observer la pr√©sence de r√©pertoires standards :

```sh
ls /
```

Constat :  
Les emplacements (`/etc`, `/home`, `/proc`, `/sys`, `/var`) ne sont pas arbitraires.  
Ils suivent une **norme Unix/Linux** (FHS), ce qui permet de s‚Äôorienter sur d‚Äôautres distributions ou syst√®mes Unix.

---

## Conclusion

La racine `/` est le point de d√©part de l‚Äôarborescence parce qu‚Äôelle est le **point de montage** du premier syst√®me de fichiers.  
Un syst√®me de fichiers n‚Äôest accessible **que s‚Äôil est mont√©**, qu‚Äôil s‚Äôagisse de donn√©es stock√©es ou d‚Äôinformations fournies par le noyau.  
Comprendre le montage est indispensable pour comprendre l‚Äôorganisation, l‚Äôacc√®s et le fonctionnement d‚Äôun syst√®me Linux.
