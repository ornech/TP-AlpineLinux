## 2.4.1 Le shell et les processus utilisateur
    
## 2.4.2 Fichiers de configuration : 

`/etc/profile`, `/etc/skel`, `~/.profile`
    
## 2.4.3 **umask**

### Les droits par défault 

Une question pertinente à traiter maintenant serait : **« Quel est le niveau de droits  par défaut d'un utilisateur lors qu'il crée un fichier ? »** . Dit autrement: Si un utilisateur crée un fichier, existe-t-il un risque que le niveau d’accès souhaitable ne soit pas respectés ?

Faisons le test. Connectez-vous avec un compte _développeur_ et créez un fichier dans `/srv/dev/` :

On constate que les fichiers possèdent les droits  **rw-rw-r--**, ce qui est lairement **trop permissif** pour un répertoire censé rester privé au groupe.

Avant d’examiner comment corriger cela, il est important de comprendre **comment ces droits sont exprimés**.  
Linux utilise en effet **deux notations complémentaires** :
- une **notation symbolique**, comme `rw-rw-r--`, pensée pour l’humain. On peut voir d’un coup d’œil qui peut lire, écrire ou exécuter ;
- une **notation octale**, comme `664`, utilisée par les commandes (`chmod`, `umask`) car elle correspond directement au fonctionnement interne du système.

Cette notation octale s’explique par la méthode dont sont tocké les permissions (r, w, x) pour le propirétaire, le groupe et les autres. Chaque droits (r,w,x) est associé à **un bit**, et dfonc ont l'active ou pas. Si on active  :
-  le premier bit `x`(exécution)  vaut **1**
- le second bit `w` (écriture) vaut **2**
- le troisième bit `r`(lecture) vaut **4**

Comment vous le savez dès lors  que l'on active un bit, sa valeur s’ajoute au total du trio. Par exemple :
- activer seulement `x` donne **1**
- activer seulement `w` donne **2**
- activer seulement `r` donne **4**
Mais si on active
-  `r` et `w` cela donne 4 + 2 = **6**
- `r` et `x` cela donne 4 + 1 = **5**
- `w` et `x` cela donne 2 + 1 = **3**
- `r`, `w` et `x` cela donne 4 + 2 + 1 = **7**

Un trio de permissions peut donc produire **8 valeurs possibles**, de 0 (`---`) à 7 (`rwx`).  
Comme ces huit valeurs se représentent naturellement par **un seul chiffre en base 8**, Unix a choisi l’octal pour coder les droits : la valeur octal décrit un trio r/w/x . On a docnt trois bits successifs qui décrivent les droits du propriétaire, puis trois bits pour le groupe et et 3bits pous les autres.

À ces trois catégories classiques — propriétaire, groupe et autres — s’ajoutent enfin trois **bits spéciaux** (SUID, SGID et Sticky), destinés à régler certains comportements particuliers (que l'on verra plus tard).

Voici le tableau complet:
![[2.3b Gestion des droits.png]]

C’est dans ce cadre que s’inscrit **le umask**.

**umask** signifie **User Mask** ou **Permission Mask**.  
C’est un **masque de permissions** appliqué automatiquement par un processus lorsqu’un fichier est créé : il retire certains bits au mode par défaut afin de déterminer les permissions finales.

> [!NOTE]
> **Le umask (User File-Creation Mode Mask)** est une valeur octale propre à chaque processus. Elle n’intervient **que lorsqu’un fichier ou un répertoire est créé** par ce processus : le umask est alors **soustrait** au mode POSIX par défaut afin de déterminer les **permissions finales** de l’objet nouvellement créé.  

Observez comment umask influence les permissions _au moment de la création_ d'un fichier

Démonstration
Affichez le umask actuel :
```
umask
```
Résultat attendu : 
- Pour un dossier : 777 – 022 = 755  
- Pour un fichier : 666 – 022 = 644

Créez un fichier
```
touch test1
ls -l test1
```

Changez le umask en 077
```
umask 077
```
Créez un second fichier :
```
touch test2
ls -l test2
```
Comparez les permissions.
- test1 → `rw-r--r--`
- test2 → `rw-------`

Pour rappel : 

> [!NOTE] umask = **attribut d’un processus**
>  - agit **uniquement lors de la création** de fichiers/répertoires
>  - fonctionne en **retirant** des permissions
>  - n’a **aucun effet après coup**
>  - ne protège pas si le dossier parent est trop permissif
>  - ne doit pas être considéré comme un mécanisme fort de sécurité



> [!NOTE]
> **“The umask is simply a process property. Nothing more, nothing less.”**  
> _(LKML – Linus Torvalds)_


**Travail demandé**  
Appliquer un umask assurant :
- fichiers : 640
- dossiers : 750  
    pour tous les membres de DEV.
    
**Validation**  
Créer un fichier test en tant que DEV → vérifier.

**Notion introduite :**  
umask = masque retiré au mode POSIX par défaut  
(agissant _uniquement_ à la création)

rôle, fonctionnement, configuration permanente
    
## 2.4.4 Politique de sécurité
    
##  2.4.5 Mise en pratique