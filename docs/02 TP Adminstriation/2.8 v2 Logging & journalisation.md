# 2.8 Journalisation sous Alpine Linux

> [!cite] â˜• Ã€ la machine Ã  cafÃ© de CorpTech  
> _â€“ Â« Cette nuit, le serveur a encore fait nâ€™importe quoi. Je nâ€™arrivais pas Ã  me connecter. Â»_  
> _â€“ Â« Aucune idÃ©e. Ce matin tout avait lâ€™air normal. Â»_

> [!NOTE]  
> Cette discussion pose une question simple Ã  laquelle personne ne peut rÃ©pondre :  
> _quâ€™est-ce quâ€™il sâ€™est passÃ© cette nuit ?_
> 
> Le problÃ¨me nâ€™est pas tant que le serveur ait dysfonctionnÃ©, mais que, le lendemain, aucune information exploitable nâ€™ait permis de comprendre ce qui sâ€™est produit.
> 
> **Le TP commence ici : comment disposer dâ€™informations exploitables sur un Ã©vÃ©nement passÃ© ?**

## 1. Observer des traces existantes

Avant toute configuration, on observe ce que le systÃ¨me conserve dÃ©jÃ .

```
logread | tail
```

Des lignes apparaissent immÃ©diatement.  
Elles proviennent de sources diffÃ©rentes : services, tÃ¢ches planifiÃ©es, processus systÃ¨me.

Premier constat :  le systÃ¨me produit des traces, et elles sont accessibles.

## 2. Constater une structure commune

En lisant plusieurs lignes affichÃ©es par `logread`, on observe une organisation constante :

- date et heure,
- nom de la machine,
- niveau de prioritÃ©,
- programme Ã©metteur,
- message texte.

Ces messages proviennent pourtant de programmes diffÃ©rents.

> _Une coÃ¯ncidence ? Comme la zone 51 officiellement non confirmÃ©eâ€¦ un simple hasard ? Je ne crois pasâ€¦_

Conclusion immÃ©diate :  
les programmes nâ€™Ã©crivent pas chacun leurs logs â€œÃ  leur faÃ§onâ€.  
Ils utilisent un **mÃ©canisme commun** qui impose un format uniforme.

---

## 3. Rappel : POSIX et journalisation

Ce comportement repose sur des conventions POSIX dÃ©jÃ  vues.

Un programme nâ€™Ã©crit pas directement dans un fichier de log.  
Il transmet un message au systÃ¨me via une interface standardisÃ©e.  
La collecte et le stockage sont assurÃ©s par le systÃ¨me.

Ce mÃ©canisme est maintenant utilisÃ© volontairement.

---

## 4. Produire une trace volontairement

```
logger -t test_log1 "Test de log : message manuel"
```

VÃ©rification :

```
logread | grep test_log1
```

Le message apparaÃ®t immÃ©diatement, avec la mÃªme structure que les autres.

Constat :  
le mÃ©canisme fonctionne.

---

## 5. RedÃ©marrage : disparition des traces

On redÃ©marre la machine.

AprÃ¨s redÃ©marrage :

```
logread | tail
```

Les messages produits prÃ©cÃ©demment ont disparu.

Constat :  
les traces Ã©taient stockÃ©es en mÃ©moire.  
Un redÃ©marrage les efface.

Ce fonctionnement est acceptable dans certains contextes  
(conteneurs, systÃ¨mes Ã©phÃ©mÃ¨res),  
mais il ne permet pas de rÃ©pondre Ã  la question de la machine Ã  cafÃ©.

---

## 6. Activer lâ€™Ã©criture sur disque

Configuration du service de journalisation :

```
cat /etc/conf.d/syslog
```

La configuration indique un stockage en mÃ©moire.

On modifie la configuration pour Ã©crire sur disque, puis :

```
rc-service syslog restart
```

---

## 7. VÃ©rifier lâ€™Ã©criture sur disque

```
logger -t test_log1 "Test de log : Ã©criture fichier"
```

```
tail /var/log/messages
```

Le message apparaÃ®t dans le fichier.

Constat :  
les traces sont dÃ©sormais Ã©crites sur disque.

---

## 8. ArrÃªt du service de journalisation

```
rc-service syslog stop
```

```
logger -t test_log1 "Test service arrÃªtÃ©"
```

Aucune nouvelle trace nâ€™apparaÃ®t.

Constat :  
sans collecteur actif, les messages ne sont pas enregistrÃ©s.

---

## 9. RedÃ©marrage du systÃ¨me

On redÃ©marre la machine.

AprÃ¨s redÃ©marrage :

```
tail /var/log/messages
```

Les traces prÃ©cÃ©demment Ã©crites ont disparu.

---

## Conclusion opÃ©rationnelle

Le mÃ©canisme de journalisation fonctionne.  
Lâ€™Ã©criture sur disque est active.  
Pourtant, les traces ne survivent pas au redÃ©marrage.

Ce comportement rÃ©sulte de choix effectuÃ©s lors du dÃ©marrage du systÃ¨me.  
Modifier ces choix implique dâ€™intervenir sur les scripts dâ€™initialisation,  
ce qui dÃ©passe le cadre de ce TP.

---

> [!warning] RÃ©ponse Ã  la machine Ã  cafÃ©  
> Le serveur a probablement redÃ©marrÃ© pendant la nuit.  Les traces nâ€™Ã©taient pas conservÃ©es par dÃ©faut aprÃ¨s redÃ©marrage, il Ã©tait donc impossible de savoir ce qui sâ€™est passÃ© Ã  partir des logs.

## ğŸ” Ce que vous devez avoir compris

- Un log nâ€™est utile que sâ€™il est **accessible au moment oÃ¹ on en a besoin**.
- La journalisation dÃ©pend de **plusieurs niveaux** :
    
    - lâ€™Ã©mission (programme â†’ POSIX),
    - la collecte (syslogd),
    - le stockage (mÃ©moire ou disque),        
    - le comportement au dÃ©marrage.
        
- Activer un mÃ©canisme ne suffit pas :  sans politique claire de conservation, les logs ne permettent pas lâ€™analyse a posteriori.
- **Ne pas corriger sans comprendre** :  intervenir sur les scripts dâ€™initialisation engage des choix dâ€™architecture systÃ¨me. La question devrait plutot se poser ainsi;  Utilisez vous la bonne distribution Linux pour l'usage que vous voulez en faire ? Oubien ne faudrait-il pas passer par un service de log plus robuste comme rsyslog ?